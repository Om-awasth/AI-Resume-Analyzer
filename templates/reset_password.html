<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Reset Password</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}" />
    <style>
        .auth-page { padding: 60px 20px; display:flex; align-items:center; justify-content:center; min-height:100vh; background: linear-gradient(135deg,#667eea 0%,#764ba2 100%);} 
        .auth-card { width:100%; max-width:420px; background:white; padding:36px; border-radius:12px; box-shadow:0 20px 60px rgba(0,0,0,0.15);} 
        .form-group { margin-bottom:16px; }
        .btn-send { width:100%; padding:12px; background:#2563eb; color:white; border:none; border-radius:8px; font-weight:600; cursor:pointer; }
    </style>
</head>
<body>
<nav class="navbar"><div class="container"><div class="nav-brand"><img src="{{ url_for('static', filename='images/logo.png') }}" alt="AI Resume Analyzer logo" class="logo" /><h1>AI Resume Analyzer</h1></div></div></nav>
<section class="auth-page">
    <div class="auth-card">
        <h2>Reset Password</h2>
        <p>Set a new password for your account.</p>
        <div class="form-group">
            <label>New Password</label>
            <input id="password" type="password" />
        </div>
        <div class="form-group">
            <button id="doReset" class="btn-send">Set Password</button>
        </div>
        <div id="msg" style="margin-top:12px; color:#334155"></div>
    </div>
</section>
<script>
function qs(name){
    const params = new URLSearchParams(window.location.search);
    return params.get(name);
}
const token = '{{ token or "" }}' || qs('token');

async function postJson(path, body){
    const r = await fetch(path, { method:'POST', credentials:'same-origin', headers:{'Content-Type':'application/json'}, body:JSON.stringify(body)});
    return r.json();
}

document.getElementById('doReset').addEventListener('click', async ()=>{
    const pw = document.getElementById('password').value;
    if(!pw){ document.getElementById('msg').textContent = 'Enter new password'; return; }
    if(!token){ document.getElementById('msg').textContent = 'Missing token'; return; }
    document.getElementById('doReset').disabled = true;
    const res = await postJson('/reset-password', { token, password: pw });
    document.getElementById('doReset').disabled = false;
    if(res.error){ document.getElementById('msg').textContent = res.error; return; }
    document.getElementById('msg').textContent = 'Password updated. Redirecting to login...';
    setTimeout(()=> window.location = '/login', 1200);
});
</script>
</body>
</html>