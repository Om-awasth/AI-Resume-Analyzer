<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Resume Analyzer & Skill Gap Predictor</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="container">
            <div class="nav-brand">
                    <img src="{{ url_for('static', filename='images/logo.png') }}" alt="AI Resume Analyzer logo" class="logo" />
                    <h1>AI Resume Analyzer</h1>
            </div>
            <ul class="nav-links">
                <li><a href="#home">Home</a></li>
                <li><a href="#features">Features</a></li>
            </ul>
            <div class="nav-actions">
                <div class="profile-menu" id="profileMenu" style="display:none;">
                    <button class="profile-btn" id="profileBtn">
                        üë§ <span id="userDisplay">User</span>
                    </button>
                    <div class="dropdown-menu" id="dropdownMenu">
                        <a href="/history" class="dropdown-item">üìä My History</a>
                        <hr style="margin: 5px 0; border: none; border-top: 1px solid #e5e7eb;">
                        <button id="btnLogout" class="dropdown-item logout-btn">üö™ Logout</button>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <!-- Hero Section -->
    <section id="home" class="hero">
        <div class="container hero-content">
            <h1>AI Resume Analyzer & Skill Gap Predictor</h1>
            <p>Analyze your resume, identify skill gaps, and get personalized learning recommendations</p>
            <a href="#analyzer" class="btn-primary">Start Analyzing</a>
        </div>
    </section>

    <!-- Main Content -->
    <section id="analyzer" class="analyzer-section">
        <div class="container">
            <div class="analyzer-card">
                <h2>Upload Your Resume</h2>
                
                <form id="uploadForm" class="upload-form">
                    <!-- File Input -->
                    <div class="form-group">
                        <label for="resumeFile" class="file-label">
                            <div class="file-input-wrapper">
                                <svg class="upload-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                                    <polyline points="17 8 12 3 7 8"></polyline>
                                    <line x1="12" y1="3" x2="12" y2="15"></line>
                                </svg>
                                <span>Click to upload PDF resume (Max 5MB)</span>
                            </div>
                            <input type="file" id="resumeFile" name="resume" accept=".pdf" required>
                        </label>
                        <p id="fileStatus" class="file-status"></p>
                    </div>

                    <!-- Job Role Selection -->
                    <div class="form-group">
                        <label for="jobRole">Select Target Job Role:</label>
                        <select id="jobRole" name="job_role" required>
                            <option value="">-- Choose a job role --</option>
                            {% for role in job_roles %}
                            <option value="{{ role }}">{{ role }}</option>
                            {% endfor %}
                        </select>
                    </div>

                    <!-- Submit Button -->
                    <button type="submit" class="btn-primary btn-analyze">
                        <span>Analyze Resume</span>
                    </button>
                </form>

                <!-- Loading State -->
                <div id="loadingState" class="loading-state" style="display: none;">
                    <div class="spinner"></div>
                    <p>Analyzing your resume...</p>
                </div>

                <!-- Error State -->
                <div id="errorState" class="error-state" style="display: none;">
                    <p id="errorMessage"></p>
                </div>
            </div>
        </div>
    </section>

    <!-- Results Section -->
    <section id="resultsSection" class="results-section" style="display: none;">
        <div class="container">
            <div class="results-container">
                <!-- Scores -->
                <div class="score-cards">
                    <div class="score-card skill-match">
                        <div class="score-value" id="skillMatchScore">0%</div>
                        <div class="score-label">Skill Match</div>
                        <div class="score-detail" id="skillMatchDetail">0/0 skills</div>
                    </div>

                    <div class="score-card tfidf-score">
                        <div class="score-value" id="tfidfScore">0%</div>
                        <div class="score-label">Text Similarity</div>
                        <div class="score-detail">TF-IDF Score</div>
                    </div>
                </div>

                <!-- Recommendation -->
                <div class="recommendation-box" id="recommendationBox">
                    <h3>üí° Recommendation</h3>
                    <p id="recommendationText"></p>
                </div>

                <!-- Tips to Improve Resume -->
                <div class="tips-section" id="tipsSection" style="display: none;">
                    <h3>üöÄ Tips to Improve Your Resume</h3>
                    <div class="tips-container">
                        <div class="tip-category">
                            <h4>üìù How to Increase Your TF-IDF Score:</h4>
                            <ul id="tfidfTips">
                                <!-- Tips will be inserted here -->
                            </ul>
                        </div>
                        <div class="tip-category">
                            <h4>üéØ Keywords to Add:</h4>
                            <div class="keywords-container" id="keywordsContainer">
                                <!-- Keywords will be inserted here -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Contact Info -->
                <div id="contactSection" style="display: none;">
                    <h3>üìû Contact Information</h3>
                    <div class="contact-info">
                        <p><strong>Email:</strong> <span id="contactEmail">-</span></p>
                        <p><strong>Phone:</strong> <span id="contactPhone">-</span></p>
                    </div>
                </div>

                <!-- Matched Skills -->
                <div class="skills-section">
                    <h3>‚úÖ Matched Skills</h3>
                    <div class="skills-container" id="matchedSkillsContainer">
                        <!-- Skills will be inserted here -->
                    </div>
                </div>

                <!-- Missing Skills -->
                <div class="skills-section">
                    <h3>‚ùå Missing Skills</h3>
                    <div class="skills-container" id="missingSkillsContainer">
                        <!-- Skills will be inserted here -->
                    </div>
                </div>

                <!-- Learning Resources -->
                <div class="resources-section">
                    <h3>üìö Learning Resources</h3>
                    <div class="resources-container" id="resourcesContainer">
                        <!-- Resources will be inserted here -->
                    </div>
                </div>

                <!-- Actions -->
                <div class="actions">
                    <button class="btn-secondary" onclick="resetForm()">üìÑ Analyze Another</button>
                </div>
            </div>
        </div>
    </section>

    <!-- Features Section -->
    <section id="features" class="features-section">
        <div class="container">
            <h2>üéØ Key Features</h2>
            <div class="features-grid">
                <div class="feature-card">
                    <div class="feature-icon">üìä</div>
                    <h3>Dual Scoring</h3>
                    <p>Skill match percentage + TF-IDF text similarity</p>
                </div>
                <div class="feature-card">
                    <div class="feature-icon">üéì</div>
                    <h3>Learning Resources</h3>
                    <p>Personalized courses and websites for missing skills</p>
                </div>
                <div class="feature-card">
                    <div class="feature-icon">‚ö°</div>
                    <h3>Fast Processing</h3>
                    <p>Analyze your resume in seconds</p>
                </div>
                <div class="feature-card">
                    <div class="feature-icon">üîç</div>
                    <h3>Skill Detection</h3>
                    <p>80+ skills across multiple job roles</p>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <p>&copy; 2024 Resume Analyzer. Built with Python, Flask, and ML/NLP.</p>
        </div>
    </footer>

    <script src="{{ url_for('static', filename='script.js') }}"></script>
    <script>
        // Check if user is logged in on page load
        async function checkAuth() {
            try {
                const res = await fetch('/api/user', { credentials: 'same-origin' });
                const data = await res.json();
                if (data.user) {
                    const userDisplay = data.user.phone_number || data.user.username || 'User';
                    document.getElementById('userDisplay').textContent = userDisplay;
                    document.getElementById('profileMenu').style.display = 'block';
                }
            } catch (e) {
                console.log('Not logged in');
            }
        }

        // Toggle dropdown menu
        document.getElementById('profileBtn').addEventListener('click', () => {
            const menu = document.getElementById('dropdownMenu');
            menu.style.display = menu.style.display === 'block' ? 'none' : 'block';
        });

        // Close dropdown when clicking outside
        document.addEventListener('click', (e) => {
            const profileMenu = document.getElementById('profileMenu');
            if (!profileMenu.contains(e.target)) {
                document.getElementById('dropdownMenu').style.display = 'none';
            }
        });

        // Logout handler
        document.getElementById('btnLogout').addEventListener('click', async () => {
            await fetch('/logout', { method: 'POST', credentials: 'same-origin' });
            window.location = '/login';
        });

        checkAuth();
    </script>
</body>
</html>
